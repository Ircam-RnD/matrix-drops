// http://codeincomplete.com/posts/2013/12/4/javascript_game_foundations_the_game_loop/
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
function timestamp() {
  return window.performance && window.performance.now ? window.performance.now() : new Date().getTime();
}

var loop = {
  run: function run(options) {

    var now = undefined;
    var dt = 0;
    var last = timestamp();
    var step = 1 / options.fps;
    var ctx = options.ctx;
    var buffers = options.buffers;
    var update = options.update;
    var render = options.render;
    var gui = options.gui;

    (function (that) {
      function loop() {
        var slow = gui && gui.slow ? gui.slow : 1; // slow motion scaling factor
        var slowStep = slow * step;

        now = timestamp();
        dt = dt + Math.min(1, (now - last) / 1000);

        while (dt > slowStep) {
          dt = dt - slowStep;
          update(step);
        }

        render(ctx, buffers, dt / slow);

        last = now;
        that.rAFid = requestAnimationFrame(loop);
      }

      that.rAFid = requestAnimationFrame(loop);
    })(this);
  },

  quit: function quit() {
    cancelAnimationFrame(this.rAFid);
  }
};

exports["default"] = loop;
module.exports = exports["default"];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jbGllbnQvcGxheWVyL3Zpc3VhbC9sb29wLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLFNBQVMsU0FBUyxHQUFHO0FBQ25CLFNBQU8sTUFBTSxDQUFDLFdBQVcsSUFBSSxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUM7Q0FDdkc7O0FBRUQsSUFBTSxJQUFJLEdBQUc7QUFDWCxLQUFHLEVBQUUsYUFBUyxPQUFPLEVBQUU7O0FBRXJCLFFBQUksR0FBRyxZQUFBLENBQUE7QUFDUCxRQUFJLEVBQUUsR0FBUyxDQUFDLENBQUE7QUFDaEIsUUFBSSxJQUFJLEdBQU8sU0FBUyxFQUFFLENBQUE7QUFDMUIsUUFBTSxJQUFJLEdBQU8sQ0FBQyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUE7QUFDaEMsUUFBTSxHQUFHLEdBQVEsT0FBTyxDQUFDLEdBQUcsQ0FBQTtBQUM1QixRQUFNLE9BQU8sR0FBSSxPQUFPLENBQUMsT0FBTyxDQUFBO0FBQ2hDLFFBQU0sTUFBTSxHQUFLLE9BQU8sQ0FBQyxNQUFNLENBQUE7QUFDL0IsUUFBTSxNQUFNLEdBQUssT0FBTyxDQUFDLE1BQU0sQ0FBQTtBQUMvQixRQUFNLEdBQUcsR0FBUSxPQUFPLENBQUMsR0FBRyxDQUMzQjs7QUFFRCxBQUFDLEtBQUEsVUFBUyxJQUFJLEVBQUU7QUFDZCxlQUFTLElBQUksR0FBRztBQUNkLFlBQU0sSUFBSSxHQUFPLEFBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEdBQUksR0FBRyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7QUFDbEQsWUFBTSxRQUFRLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQzs7QUFFN0IsV0FBRyxHQUFHLFNBQVMsRUFBRSxDQUFDO0FBQ2xCLFVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFBLEdBQUksSUFBSSxDQUFDLENBQUM7O0FBRTNDLGVBQU0sRUFBRSxHQUFHLFFBQVEsRUFBRTtBQUNqQixZQUFFLEdBQUcsRUFBRSxHQUFHLFFBQVEsQ0FBQztBQUNuQixnQkFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2hCOztBQUVELGNBQU0sQ0FBQyxHQUFHLEVBQUUsT0FBTyxFQUFFLEVBQUUsR0FBQyxJQUFJLENBQUMsQ0FBQzs7QUFFOUIsWUFBSSxHQUFHLEdBQUcsQ0FBQztBQUNYLFlBQUksQ0FBQyxLQUFLLEdBQUcscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7T0FDMUM7O0FBRUQsVUFBSSxDQUFDLEtBQUssR0FBRyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUMxQyxDQUFBLENBQUMsSUFBSSxDQUFDLENBQUU7R0FDVjs7QUFFRCxNQUFJLEVBQUUsZ0JBQVc7QUFDZix3QkFBb0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7R0FDbEM7Q0FDRixDQUFDOztxQkFFYSxJQUFJIiwiZmlsZSI6InNyYy9jbGllbnQvcGxheWVyL3Zpc3VhbC9sb29wLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaHR0cDovL2NvZGVpbmNvbXBsZXRlLmNvbS9wb3N0cy8yMDEzLzEyLzQvamF2YXNjcmlwdF9nYW1lX2ZvdW5kYXRpb25zX3RoZV9nYW1lX2xvb3AvXG5mdW5jdGlvbiB0aW1lc3RhbXAoKSB7XG4gIHJldHVybiB3aW5kb3cucGVyZm9ybWFuY2UgJiYgd2luZG93LnBlcmZvcm1hbmNlLm5vdyA/IHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKSA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xufVxuXG5jb25zdCBsb29wID0ge1xuICBydW46IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblxuICAgIGxldCBub3dcbiAgICBsZXQgZHQgICAgICAgPSAwXG4gICAgbGV0IGxhc3QgICAgID0gdGltZXN0YW1wKClcbiAgICBjb25zdCBzdGVwICAgICA9IDEgLyBvcHRpb25zLmZwc1xuICAgIGNvbnN0IGN0eCAgICAgID0gb3B0aW9ucy5jdHhcbiAgICBjb25zdCBidWZmZXJzICA9IG9wdGlvbnMuYnVmZmVyc1xuICAgIGNvbnN0IHVwZGF0ZSAgID0gb3B0aW9ucy51cGRhdGVcbiAgICBjb25zdCByZW5kZXIgICA9IG9wdGlvbnMucmVuZGVyXG4gICAgY29uc3QgZ3VpICAgICAgPSBvcHRpb25zLmd1aVxuICAgIDtcblxuICAgIChmdW5jdGlvbih0aGF0KSB7XG4gICAgICBmdW5jdGlvbiBsb29wKCkge1xuICAgICAgICBjb25zdCBzbG93ICAgICA9IChndWkgJiYgZ3VpLnNsb3cpID8gZ3VpLnNsb3cgOiAxOyAvLyBzbG93IG1vdGlvbiBzY2FsaW5nIGZhY3RvclxuICAgICAgICBjb25zdCBzbG93U3RlcCA9IHNsb3cgKiBzdGVwO1xuXG4gICAgICAgIG5vdyA9IHRpbWVzdGFtcCgpO1xuICAgICAgICBkdCA9IGR0ICsgTWF0aC5taW4oMSwgKG5vdyAtIGxhc3QpIC8gMTAwMCk7XG5cbiAgICAgICAgd2hpbGUoZHQgPiBzbG93U3RlcCkge1xuICAgICAgICAgICAgZHQgPSBkdCAtIHNsb3dTdGVwO1xuICAgICAgICAgICAgdXBkYXRlKHN0ZXApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVuZGVyKGN0eCwgYnVmZmVycywgZHQvc2xvdyk7XG5cbiAgICAgICAgbGFzdCA9IG5vdztcbiAgICAgICAgdGhhdC5yQUZpZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShsb29wKTtcbiAgICAgIH1cblxuICAgICAgdGhhdC5yQUZpZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShsb29wKTtcbiAgICB9KHRoaXMpKTtcbiAgfSxcblxuICBxdWl0OiBmdW5jdGlvbigpIHtcbiAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLnJBRmlkKTtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgbG9vcDtcbiJdfQ==