// http://codeincomplete.com/posts/2013/12/4/javascript_game_foundations_the_game_loop/
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
function timestamp() {
  return window.performance && window.performance.now ? window.performance.now() : new Date().getTime();
}

var loop = {
  run: function run(options) {

    var now = undefined;
    var dt = 0;
    var last = timestamp();
    var step = 1 / options.fps;
    var ctx = options.ctx;
    var buffers = options.buffers;
    var update = options.update;
    var render = options.render;
    var gui = options.gui;

    (function (that) {
      function loop() {
        var slow = gui && gui.slow ? gui.slow : 1; // slow motion scaling factor
        var slowStep = slow * step;

        now = timestamp();
        dt = dt + Math.min(1, (now - last) / 1000);

        while (dt > slowStep) {
          dt = dt - slowStep;
          update(step);
        }

        render(ctx, buffers, dt / slow);

        last = now;
        that.rAFid = requestAnimationFrame(loop);
      }

      that.rAFid = requestAnimationFrame(loop);
    })(this);
  },

  quit: function quit() {
    cancelAnimationFrame(this.rAFid);
  }
};

exports["default"] = loop;
module.exports = exports["default"];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9zY2huZWxsL0RldmVsb3BtZW50L3dlYi9jb2xsZWN0aXZlLXNvdW5kd29ya3MvZHJvcHMvc3JjL2NsaWVudC9wbGF5ZXIvdmlzdWFsL2xvb3AuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsU0FBUyxTQUFTLEdBQUc7QUFDbkIsU0FBTyxNQUFNLENBQUMsV0FBVyxJQUFJLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztDQUN2Rzs7QUFFRCxJQUFNLElBQUksR0FBRztBQUNYLEtBQUcsRUFBRSxhQUFTLE9BQU8sRUFBRTs7QUFFckIsUUFBSSxHQUFHLFlBQUEsQ0FBQTtBQUNQLFFBQUksRUFBRSxHQUFTLENBQUMsQ0FBQTtBQUNoQixRQUFJLElBQUksR0FBTyxTQUFTLEVBQUUsQ0FBQTtBQUMxQixRQUFNLElBQUksR0FBTyxDQUFDLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQTtBQUNoQyxRQUFNLEdBQUcsR0FBUSxPQUFPLENBQUMsR0FBRyxDQUFBO0FBQzVCLFFBQU0sT0FBTyxHQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUE7QUFDaEMsUUFBTSxNQUFNLEdBQUssT0FBTyxDQUFDLE1BQU0sQ0FBQTtBQUMvQixRQUFNLE1BQU0sR0FBSyxPQUFPLENBQUMsTUFBTSxDQUFBO0FBQy9CLFFBQU0sR0FBRyxHQUFRLE9BQU8sQ0FBQyxHQUFHLENBQzNCOztBQUVELEFBQUMsS0FBQSxVQUFTLElBQUksRUFBRTtBQUNkLGVBQVMsSUFBSSxHQUFHO0FBQ2QsWUFBTSxJQUFJLEdBQU8sQUFBQyxHQUFHLElBQUksR0FBRyxDQUFDLElBQUksR0FBSSxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztBQUNsRCxZQUFNLFFBQVEsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDOztBQUU3QixXQUFHLEdBQUcsU0FBUyxFQUFFLENBQUM7QUFDbEIsVUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUEsR0FBSSxJQUFJLENBQUMsQ0FBQzs7QUFFM0MsZUFBTSxFQUFFLEdBQUcsUUFBUSxFQUFFO0FBQ2pCLFlBQUUsR0FBRyxFQUFFLEdBQUcsUUFBUSxDQUFDO0FBQ25CLGdCQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDaEI7O0FBRUQsY0FBTSxDQUFDLEdBQUcsRUFBRSxPQUFPLEVBQUUsRUFBRSxHQUFDLElBQUksQ0FBQyxDQUFDOztBQUU5QixZQUFJLEdBQUcsR0FBRyxDQUFDO0FBQ1gsWUFBSSxDQUFDLEtBQUssR0FBRyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztPQUMxQzs7QUFFRCxVQUFJLENBQUMsS0FBSyxHQUFHLHFCQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDO0tBQzFDLENBQUEsQ0FBQyxJQUFJLENBQUMsQ0FBRTtHQUNWOztBQUVELE1BQUksRUFBRSxnQkFBVztBQUNmLHdCQUFvQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztHQUNsQztDQUNGLENBQUM7O3FCQUVhLElBQUkiLCJmaWxlIjoiL1VzZXJzL3NjaG5lbGwvRGV2ZWxvcG1lbnQvd2ViL2NvbGxlY3RpdmUtc291bmR3b3Jrcy9kcm9wcy9zcmMvY2xpZW50L3BsYXllci92aXN1YWwvbG9vcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGh0dHA6Ly9jb2RlaW5jb21wbGV0ZS5jb20vcG9zdHMvMjAxMy8xMi80L2phdmFzY3JpcHRfZ2FtZV9mb3VuZGF0aW9uc190aGVfZ2FtZV9sb29wL1xuZnVuY3Rpb24gdGltZXN0YW1wKCkge1xuICByZXR1cm4gd2luZG93LnBlcmZvcm1hbmNlICYmIHdpbmRvdy5wZXJmb3JtYW5jZS5ub3cgPyB3aW5kb3cucGVyZm9ybWFuY2Uubm93KCkgOiBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbn1cblxuY29uc3QgbG9vcCA9IHtcbiAgcnVuOiBmdW5jdGlvbihvcHRpb25zKSB7XG5cbiAgICBsZXQgbm93XG4gICAgbGV0IGR0ICAgICAgID0gMFxuICAgIGxldCBsYXN0ICAgICA9IHRpbWVzdGFtcCgpXG4gICAgY29uc3Qgc3RlcCAgICAgPSAxIC8gb3B0aW9ucy5mcHNcbiAgICBjb25zdCBjdHggICAgICA9IG9wdGlvbnMuY3R4XG4gICAgY29uc3QgYnVmZmVycyAgPSBvcHRpb25zLmJ1ZmZlcnNcbiAgICBjb25zdCB1cGRhdGUgICA9IG9wdGlvbnMudXBkYXRlXG4gICAgY29uc3QgcmVuZGVyICAgPSBvcHRpb25zLnJlbmRlclxuICAgIGNvbnN0IGd1aSAgICAgID0gb3B0aW9ucy5ndWlcbiAgICA7XG5cbiAgICAoZnVuY3Rpb24odGhhdCkge1xuICAgICAgZnVuY3Rpb24gbG9vcCgpIHtcbiAgICAgICAgY29uc3Qgc2xvdyAgICAgPSAoZ3VpICYmIGd1aS5zbG93KSA/IGd1aS5zbG93IDogMTsgLy8gc2xvdyBtb3Rpb24gc2NhbGluZyBmYWN0b3JcbiAgICAgICAgY29uc3Qgc2xvd1N0ZXAgPSBzbG93ICogc3RlcDtcblxuICAgICAgICBub3cgPSB0aW1lc3RhbXAoKTtcbiAgICAgICAgZHQgPSBkdCArIE1hdGgubWluKDEsIChub3cgLSBsYXN0KSAvIDEwMDApO1xuXG4gICAgICAgIHdoaWxlKGR0ID4gc2xvd1N0ZXApIHtcbiAgICAgICAgICAgIGR0ID0gZHQgLSBzbG93U3RlcDtcbiAgICAgICAgICAgIHVwZGF0ZShzdGVwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlbmRlcihjdHgsIGJ1ZmZlcnMsIGR0L3Nsb3cpO1xuXG4gICAgICAgIGxhc3QgPSBub3c7XG4gICAgICAgIHRoYXQuckFGaWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7XG4gICAgICB9XG5cbiAgICAgIHRoYXQuckFGaWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobG9vcCk7XG4gICAgfSh0aGlzKSk7XG4gIH0sXG5cbiAgcXVpdDogZnVuY3Rpb24oKSB7XG4gICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5yQUZpZCk7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IGxvb3A7XG4iXX0=